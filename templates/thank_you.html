{% extends 'base.html' %}

{% block title %}خدمة شحن الرصيد - شكراً لك{% endblock %}

{% block head %}
<script>
    // تحسين أداء JavaScript - استخدام DOMContentLoaded بدلاً من window.onload
    document.addEventListener('DOMContentLoaded', function() {
        // الحصول على الروابط والرسائل من الخادم
        var whatsappMessage = `{{ whatsapp_message|replace('\n', '\\n')|safe }}`;
        var primaryUrl = "{{ whatsapp_url_alt }}";  // رابط wa.me
        var fallbackUrl = "{{ whatsapp_url }}";     // رابط api.whatsapp.com

        // تحديث زر الواتساب الرئيسي فوراً
        var mainButton = document.getElementById('whatsapp-button');
        if (mainButton) {
            mainButton.setAttribute('data-url', primaryUrl);
            mainButton.setAttribute('data-fallback', fallbackUrl);
        }
    });
</script>
{% endblock %}

{% block content %}
<div class="thank-you">
    <h2>شكراً لطلبك!</h2>
    <div class="alert alert-success mb-4">
        <p>تم استلام طلبك بنجاح.</p>
        <p><strong>لن يتم شحن رصيدك إلا بعد إرسال تفاصيل الطلب و اسكرين بالتحويل على الواتساب.</strong></p>
        <div class="text-center mt-3">
            <i class="bi bi-arrow-down fs-1 text-success animate__animated animate__bounce animate__infinite"></i>
        </div>
    </div>

    <div class="d-grid gap-3 mb-4">
        <!-- زر إرسال تفاصيل الطلب عبر واتساب -->
        <a href="#" id="whatsapp-button"
           onclick="sendWhatsApp()"
           class="btn btn-success btn-lg">
            <i class="bi bi-whatsapp me-2"></i>إرسال تفاصيل الطلب عبر واتساب
        </a>
    </div>

    <!-- تم إزالة الرابط الاحتياطي بناءً على طلب العميل -->

    <script>
        // دالة محسنة لإرسال رسالة واتساب
        function sendWhatsApp() {
            var button = document.getElementById('whatsapp-button');
            var primaryUrl = button ? button.getAttribute('data-url') : "{{ whatsapp_url_alt }}";

            // استخدام الرابط الأساسي مباشرة لتحسين الأداء
            window.location.href = primaryUrl;
            return false;
        }
    </script>

    <!-- تم إزالة العناصر المخفية غير الضرورية لتحسين الأداء -->

    <p>سيتم شحن رصيدك خلال بضع دقائق و خلال 30 دقيقة كحد أقصى من وقت تأكيد التحويل.</p>



    <div class="alert alert-danger mb-4">
        <p><strong>تحذير:</strong> يرجى العلم أن أي تعديل في رسالة الطلب تؤدي إلى حظر رقمك نهائياً.</p>
    </div>

    <div class="alert alert-info mb-4">
        <p>إذا كان لديك أي استفسار، يرجى التواصل معنا على الواتساب: <strong>+201012874414</strong></p>
    </div>

    <a href="{{ url_for('index') }}" class="btn btn-primary">العودة للصفحة الرئيسية</a>
</div>
{% endblock %}
